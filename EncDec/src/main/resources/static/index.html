<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Encryptor & Decryptor</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>
<body>
<div class="container mt-5">
    <h2 class="text-center">File Encryption & Decryption</h2>

    <!-- File Upload & Password Input -->
    <div class="mb-3">
        <label class="form-label">Choose File:</label>
        <input type="file" id="fileInput" class="form-control" />
    </div>

    <div class="mb-3">
        <label class="form-label">Enter Password:</label>
        <input type="password" id="passwordInput" class="form-control" />
    </div>

    <!-- Buttons for Encrypt & Decrypt -->
    <button class="btn btn-success" onclick="handleFile('encrypt')">Encrypt File</button>
    <button class="btn btn-primary" onclick="handleFile('decrypt')">Decrypt File</button>

    <p id="status" class="mt-3"></p>
</div>

<script>
    async function handleFile(action) {
      const fileInput = document.getElementById("fileInput");
      const passwordInput = document.getElementById("passwordInput");
      const status = document.getElementById("status");

      if (!fileInput.files.length) {
        status.innerHTML = "<span class='text-danger'>Please select a file!</span>";
        return;
      }

      if (!passwordInput.value) {
        status.innerHTML = "<span class='text-danger'>Please enter a password!</span>";
        return;
      }

      const file = fileInput.files[0];
      const formData = new FormData();
      formData.append("file", file);
      formData.append("password", passwordInput.value);

      status.innerHTML = "<span class='text-info'>Processing...</span>";

      try {
        // Use your hosted backend URL here:
        const response = await fetch(`https://everyday-pia-tcs12-703f4f96.koyeb.app/file/${action}`, {
          method: "POST",
          body: formData
        });

        if (!response.ok) {
          throw new Error(await response.text());
        }

        // Download the processed file
        const blob = await response.blob();
        const downloadLink = document.createElement("a");
        downloadLink.href = URL.createObjectURL(blob);
        downloadLink.download = (action === "encrypt" ? "encrypted_" : "decrypted_") + file.name;
        document.body.appendChild(downloadLink);
        downloadLink.click();
        document.body.removeChild(downloadLink);

        status.innerHTML = "<span class='text-success'>File processed successfully!</span>";
      } catch (error) {
        status.innerHTML = `<span class='text-danger'>Error: ${error.message}</span>`;
      }
    }
</script>
</body>
</html>
